name: workflow to build and deploy to Azure

on: push

jobs:
  build-in-actions-workflow:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@master
              
   # Authentication
    # - uses: azure/login@v1
    #   with:
    #     creds: ${{ secrets.AZURE_CREDENTIALS  }}
    - name: Setup Azure Login using Service Principal
      uses: azure/login@v1
      with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}      
  deploy-using-azure-pipelines:
    needs: build-in-actions-workflow
    runs-on: ubuntu-latest
    steps:
    - name: 'Trigger an Azure Pipeline to deploy the app to PRODUCTION'
      uses: Azure/pipelines@releases/v1
      with:
        azure-devops-project-url: 'https://dev.azure.com/devopsokn/MyPOC'
        azure-pipeline-name: 'test_Automation_Repo' 
        azure-devops-token: '${{ secrets.AZURE_DEVOPS_TOKEN }}'

